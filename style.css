// ==========================================
// CONFIGURACIÓN: CAMBIA ESTA FECHA POR LA SUYA
// Formato: Año, Mes (Enero=0, Febrero=1...), Día, Hora, Minutos
const fechaInicio = new Date(2023, 1, 14, 18, 00); 
// ==========================================

// Textos para la máquina de escribir
const textoTitulo = "Para el amor de mi vida";
const textoSubtitulo = "Mi amor por ti comenzó hace...";
const textoMensaje = "Y cada segundo te amo más.";

let appIniciada = false;

function iniciarAnimacion() {
    if (appIniciada) return;
    appIniciada = true;

    // 1. Ocultar pantalla de inicio
    document.getElementById('start-screen').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('start-screen').style.display = 'none';
        // 2. Mostrar contenedor principal
        document.getElementById('main-content').classList.remove('hidden');
        document.getElementById('main-content').classList.add('visible');
        
        // 3. Iniciar secuencia de textos
        escribirTexto('titulo', textoTitulo, 100, () => {
            escribirTexto('subtitulo', textoSubtitulo, 80, () => {
                // 4. Mostrar contador y mensaje final
                document.getElementById('contador').classList.remove('hidden');
                document.getElementById('contador').classList.add('visible');
                actualizarContador();
                setInterval(actualizarContador, 1000);
                
                escribirTexto('mensaje-final', textoMensaje, 80, () => {
                    // 5. Finalmente, ¡aparece el árbol!
                    document.getElementById('tree-container').classList.remove('hidden');
                    document.getElementById('tree-container').classList.add('visible');
                    crearArbolFrondoso();
                    // Empezar a dejar caer hojas después de que el árbol florezca
                    setTimeout(() => setInterval(crearHojaCayendo, 800), 2000);
                });
            });
        });
    }, 800);
}

// Función para efecto de máquina de escribir
function escribirTexto(elementoId, texto, velocidad, callback) {
    let i = 0;
    const elemento = document.getElementById(elementoId);
    elemento.innerHTML = ""; // Limpiar
    function escribir() {
        if (i < texto.length) {
            elemento.innerHTML += texto.charAt(i);
            i++;
            setTimeout(escribir, velocidad);
        } else {
            // Quitar el cursor parpadeante al terminar
            elemento.classList.remove('typewriter');
            if (callback) callback();
        }
    }
    escribir();
}

function actualizarContador() {
    const ahora = new Date();
    const diferencia = ahora - fechaInicio;
    const dias = Math.floor(diferencia / (1000 * 60 * 60 * 24));
    const horas = Math.floor((diferencia % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutos = Math.floor((diferencia % (1000 * 60 * 60)) / (1000 * 60));
    const segundos = Math.floor((diferencia % (1000 * 60)) / 1000);
    document.getElementById("contador").innerText = 
        `${dias} Días ${horas}h ${minutos}m ${segundos}s`;
}

// Nuevo Árbol Frondoso
function crearArbolFrondoso() {
    const contenedor = document.getElementById("heart-leaves");
    const colores = ["#ff4d6d", "#c9184a", "#ff758f", "#ff8fa3", "#e63946"];
    
    // Crear MUCHAS más hojas (150 en lugar de 60)
    for (let i = 0; i < 150; i++) {
        const corazon = document.createElement("div");
        corazon.classList.add("heart");
        
        // Usar coordenadas polares para una copa más redonda y natural
        const angle = Math.random() * Math.PI * 2; // Ángulo aleatorio
        const radius = Math.random() * 100; // Radio aleatorio
        const x = Math.cos(angle) * radius * 1.2; // Dispersión horizontal
        const y = Math.sin(angle) * radius * 0.8 + 180; // Dispersión vertical + altura base

        corazon.style.bottom = `${y}px`;
        corazon.style.left = `calc(50% + ${x}px)`;
        
        // Color, tamaño y rotación aleatorios
        const color = colores[Math.floor(Math.random() * colores.length)];
        const scale = Math.random() * 0.6 + 0.5; // Escala entre 0.5 y 1.1
        const rotation = Math.random() * 90 - 45; // Rotación ligera

        corazon.style.setProperty('--scale', scale);
        corazon.style.transform = `rotate(${rotation}deg) scale(0)`;
        
        corazon.style.backgroundColor = color;
        const style = document.createElement('style');
        style.innerHTML = `.heart:nth-child(${i+1})::before, .heart:nth-child(${i+1})::after { background-color: ${color}; }`;
        document.head.appendChild(style);

        corazon.style.animationDelay = `${Math.random() * 3}s`; // Aparecen en 3 segundos

        contenedor.appendChild(corazon);
    }
}

// Función para crear hojas que caen
function crearHojaCayendo() {
    const contenedor = document.getElementById("tree-container");
    const colores = ["#ff4d6d", "#ff758f"];
    const hoja = document.createElement("div");
    hoja.classList.add("falling-heart");

    const color = colores[Math.floor(Math.random() * colores.length)];
    hoja.style.backgroundColor = color;
    hoja.style.left = `calc(50% + ${Math.random() * 100 - 50}px)`; // Posición inicial horizontal

    const style = document.createElement('style');
    style.innerHTML = `.falling-heart:last-child::before, .falling-heart:last-child::after { background-color: ${color}; }`;
    document.head.appendChild(style);

    contenedor.appendChild(hoja);

    // Eliminar la hoja después de que caiga para no llenar la memoria
    setTimeout(() => {
        hoja.remove();
        style.remove();
    }, 4000);
}
